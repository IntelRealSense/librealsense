env:
  global:
    - LRS_BUILD_CONFIG=Debug
matrix:
  include:
    - name: "Windows Testing - cpp"
      os: windows
      language: cpp
      env: VS15=true RS_CPP_TEST=true
      script:
        - powershell "Dism /online /enable-feature /FeatureName:ServerMediaFoundation /NoRestart"
        - powershell "Dism /online /get-features"        
        - cmake .. -G "Visual Studio 14 2015 Win64" -DBUILD_UNIT_TESTS=true -DBUILD_EXAMPLES=false -DBUILD_WITH_TM2=false -DBUILD_SHARED_LIBS=false
        - cmake --build . --config $LRS_BUILD_CONFIG -- -m:4
        - cd $LRS_BUILD_CONFIG
        - ls
        - ./live-test.exe -d yes -i [software-device]

    - name: "Windows Testing - cpp"
      os: windows
      language: cpp
      env: VS17=true RS_CPP_TEST=true
      script:
        - cmake .. -G "Visual Studio 15 2017 Win64" -DBUILD_UNIT_TESTS=true -DBUILD_EXAMPLES=false -DBUILD_WITH_TM2=false -DBUILD_SHARED_LIBS=false
        - cmake --build . --config $LRS_BUILD_CONFIG -- -m:4
        - cd $LRS_BUILD_CONFIG
        - ls
        - ./live-test.exe -d yes -i [software-device]

    - name: "Windows Testing - cpp"
      os: windows
      language: cpp
      env: VS15=true RS_CPP_TEST=true
      script:       
        - cmake .. -G "Visual Studio 14 2015 Win64" -DBUILD_UNIT_TESTS=true -DBUILD_EXAMPLES=false -DBUILD_WITH_TM2=false -DBUILD_SHARED_LIBS=false
        - cmake --build . --config $LRS_BUILD_CONFIG -- -m:4
        - cd $LRS_BUILD_CONFIG
        - ls
        - ./live-test.exe -d yes -i [software-device]

    - name: "Windows Testing - cpp"
      os: windows
      language: cpp
      env: VS17=true RS_CPP_TEST=true
      script:
        - powershell "Dism /online /enable-feature /FeatureName:ServerMediaFoundation /NoRestart"
        - powershell "Dism /online /get-features" 
        - cmake .. -G "Visual Studio 15 2017 Win64" -DBUILD_UNIT_TESTS=true -DBUILD_EXAMPLES=false -DBUILD_WITH_TM2=false -DBUILD_SHARED_LIBS=false
        - cmake --build . --config $LRS_BUILD_CONFIG -- -m:4
        - cd $LRS_BUILD_CONFIG
        - ls
        - ./live-test.exe -d yes -i [software-device]

before_install:
  - mkdir build && cd build
  
install:
  - if [[ "$TRAVIS_OS_NAME" == "windows" ]]; then
      if [[ "$VS15" == "true" ]]; then
        choco install -y vcbuildtools --version 2015.4 --force;
      fi
    fi